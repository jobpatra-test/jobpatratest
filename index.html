<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JobPatra ‚Äì Explore Careers in India</title>

  <!-- Google Verification -->
  <meta name="google-site-verification" content="your-unique-code" />

  <!-- Basic SEO -->
  <meta name="description" content="JobPatra helps you discover verified company career pages, jobs, and hiring opportunities across India. Explore sectors, states, and cities easily.">
  <meta name="keywords" content="JobPatra, jobs in India, company career pages, Indian companies hiring, IT jobs, government jobs, startup jobs">
  <meta name="author" content="JobPatra">
  <meta name="robots" content="index, follow">

  <!-- Open Graph -->
  <meta property="og:title" content="JobPatra ‚Äì Find Real Jobs from Real Companies">
  <meta property="og:description" content="Explore genuine job openings directly from verified company career pages across India.">
  <meta property="og:image" content="https://jobpatra.github.io/logo.png">
  <meta property="og:url" content="https://jobpatra.github.io/">
  <meta property="og:type" content="website">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="JobPatra ‚Äì Find Real Jobs from Real Companies">
  <meta name="twitter:description" content="Discover genuine jobs from official company career pages in India.">
  <meta name="twitter:image" content="https://jobpatra.github.io/logo.png">

  <!-- Favicon -->
  <link rel="icon" href="logo.png" type="image/png">

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1948921365546153"
     crossorigin="anonymous"></script>

  <!-- PapaParse CSV Parser -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f9ff;
      margin: 0;
      padding: 0;
      color: #222;
    }
    header {
      text-align: center;
      background-color: #1565c0;
      color: #fff;
      padding: 20px;
      font-size: 1.6rem;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .container {
      max-width: 600px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .note {
      background: #e3f2fd;
      color: #0d47a1;
      padding: 12px;
      border-radius: 8px;
      font-size: 0.95rem;
      text-align: center;
      margin-bottom: 15px;
      line-height: 1.5;
    }
    h2 {
      text-align: center;
      color: #0d47a1;
      font-size: 1.3rem;
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: 600;
      margin: 10px 0 5px;
      color: #333;
    }
    select, button {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 14px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    select:focus {
      border-color: #1565c0;
      outline: none;
    }
    button {
      background-color: #1976d2;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      transition: 0.2s;
    }
    button:hover { background-color: #0d47a1; }
    .ad-banner { text-align: center; margin-top: 10px; }
    .ad-banner img {
      width: 100%;
      max-width: 468px;
      border-radius: 8px;
      transition: opacity 0.3s ease;
    }
    .error {
      color: #b71c1c;
      background: #ffebee;
      padding: 8px;
      border-radius: 6px;
      margin-bottom: 10px;
      display: none;
    }
    footer {
      text-align: center;
      font-size: 0.9rem;
      color: #777;
      padding: 20px;
    }
  </style>
</head>

<body>
  <header>üíº JobPatra</header>

  <div class="container">
    <div class="note">
      Some companies post openings only on their official career pages.
      Visit company websites directly if jobs aren‚Äôt listed elsewhere.
    </div>

    <div id="dataError" class="error">‚ö†Ô∏è Unable to load job data. Please refresh or check your internet connection.</div>

    <h2>Search Career Opportunities</h2>

    <label for="sector">Select Sector <small style="font-weight:600;color:#b71c1c;">(required)</small></label>
    <select id="sector"><option value="">-- Select Sector (required) --</option></select>

    <label for="state">Select State (optional)</label>
    <select id="state" disabled><option value="">Select State</option></select>

    <label for="city">Select City (optional)</label>
    <select id="city" disabled><option value="">Select City</option></select>

    <div id="formError" class="error">Please select a sector before searching.</div>

    <button id="searchBtn">üîç Search</button>

    <div class="ad-banner">
      <img id="indexAd" src="https://via.placeholder.com/468x60.png?text=Ad+1" alt="Ad Banner">
    </div>
  </div>

  <footer>
    <a href="about.html">About</a> |
    <a href="privacy.html">Privacy Policy</a> |
    <a href="disclaimer.html">Disclaimer</a> |
    <a href="contact.html">Contact</a>
    <br>¬© 2025 JobPatra. All rights reserved.
  </footer>

<script>
const CSV_FILE = "data.csv";
const LS_KEY = "jobpatra_cache_v2"; // bump version to refresh cache

// Helper
function cleanText(v) {
  return (v || "").trim().replace(/^"+|"+$/g, "").replace(/^'+|'+$/g, "");
}

// Load CSV with PapaParse
async function loadCsv(forceReload = false) {
  if (!forceReload) {
    const cache = localStorage.getItem(LS_KEY);
    if (cache) return JSON.parse(cache);
  }
  try {
    const response = await fetch(CSV_FILE, { cache: "no-store" });
    if (!response.ok) throw new Error("Network error");
    const csvText = await response.text();
    const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
    if (!parsed.data || parsed.data.length === 0) throw new Error("No data");
    const rows = parsed.data.map(row => ({
      company: cleanText(row.Company),
      sector: cleanText(row.Sector),
      state: cleanText(row.State),
      city: cleanText(row.City),
      roles: cleanText(row.Roles),
      linkedin: cleanText(row.LinkedIn),
      website: cleanText(row.Website)
    }));
    localStorage.setItem(LS_KEY, JSON.stringify(rows));
    return rows;
  } catch (err) {
    console.error("CSV load error:", err);
    document.getElementById("dataError").style.display = "block";
    return [];
  }
}

// Dropdown setup
async function setupDropdowns() {
  const data = await loadCsv();
  const sectorSel = document.getElementById("sector");
  const stateSel = document.getElementById("state");
  const citySel = document.getElementById("city");

  const sectors = [...new Set(data.map(d => d.sector).filter(v => v && !v.match(/^http/i)))].sort();
  sectors.forEach(s => {
    const opt = document.createElement("option");
    opt.value = s;
    opt.textContent = s;
    sectorSel.appendChild(opt);
  });

  sectorSel.addEventListener("change", () => {
    const selSector = sectorSel.value;
    stateSel.innerHTML = '<option value="">Select State</option>';
    citySel.innerHTML = '<option value="">Select City</option>';
    citySel.disabled = true;

    if (!selSector) {
      stateSel.disabled = true;
      return;
    }

    const states = [...new Set(data.filter(d => d.sector === selSector).map(d => d.state).filter(Boolean))].sort();
    states.forEach(st => {
      const opt = document.createElement("option");
      opt.value = st;
      opt.textContent = st;
      stateSel.appendChild(opt);
    });
    stateSel.disabled = false;
  });

  stateSel.addEventListener("change", () => {
    const selSec = sectorSel.value;
    const selSt = stateSel.value;
    citySel.innerHTML = '<option value="">Select City</option>';
    const cities = [...new Set(data.filter(d => d.sector === selSec && d.state === selSt).map(d => d.city).filter(Boolean))].sort();
    cities.forEach(ct => {
      const opt = document.createElement("option");
      opt.value = ct;
      opt.textContent = ct;
      citySel.appendChild(opt);
    });
    citySel.disabled = cities.length === 0;
  });
}

// Initialize
document.addEventListener("DOMContentLoaded", async () => {
  await setupDropdowns();

  const err = document.getElementById("formError");
  document.getElementById("searchBtn").addEventListener("click", () => {
    const s = document.getElementById("sector").value;
    const st = document.getElementById("state").value;
    const c = document.getElementById("city").value;
    if (!s) {
      err.style.display = "block";
      return;
    }
    err.style.display = "none";
    window.location.href = `results.html?sector=${encodeURIComponent(s)}&state=${encodeURIComponent(st)}&city=${encodeURIComponent(c)}`;
  });

  // Ad rotation
  const ads = [
    "https://via.placeholder.com/468x60.png?text=Ad+1",
    "https://via.placeholder.com/468x60.png?text=Ad+2",
    "https://via.placeholder.com/468x60.png?text=Ad+3"
  ];
  let i = 0;
  setInterval(() => {
    i = (i + 1) % ads.length;
    const img = document.getElementById("indexAd");
    img.style.opacity = 0;
    setTimeout(() => {
      img.src = ads[i];
      img.style.opacity = 1;
    }, 300);
  }, 10000);
});
</script>
</body>
      </html>
